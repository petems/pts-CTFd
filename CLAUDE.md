# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

CTFd is a Capture The Flag (CTF) framework built with Python/Flask focusing on ease of use and customizability. It provides a complete platform for running cybersecurity competitions with challenges, scoring, team management, and administrative interfaces.

## Development Commands

### Primary Development

- `python serve.py` - Start development server on port 4000 with hot reload
- `python serve.py --port 8000` - Start on custom port
- `python serve.py --profile` - Enable Flask profiler and debug toolbar
- `python manage.py shell` - Start Flask shell for database operations

### Testing

- `make test` - Run complete test suite (pytest with coverage, bandit security scan, yarn verification)
- `pytest -rf --cov=CTFd --cov-context=test --cov-report=xml -n auto` - Core test command
- `pytest tests/specific_test.py` - Run specific test file
- `pytest tests/specific_test.py::test_function` - Run specific test function

### Code Quality & Linting

- `make lint` - Run all linting (ruff, yarn lint, black, prettier)
- `make format` - Auto-format code (isort, black, prettier)
- `ruff check --select E,F,W,B,C4,I --ignore E402,E501,E712,B904,B905 --exclude=CTFd/uploads CTFd/ migrations/ tests/` - Python linting
- `yarn lint` - JavaScript/CSS linting
- `black --check --diff --exclude=CTFd/uploads --exclude=node_modules .` - Python formatting check

### Frontend Build

- `yarn dev` - Watch mode development build
- `yarn build` - Production build (development + production modes)
- `yarn verify` - Verify build integrity and git status
- `yarn clean` - Clean built assets

### Database

- `flask db upgrade` - Run database migrations
- `python populate.py` - Populate database with sample data (development)

## Architecture Overview

### Core Structure

- **CTFd/**init**.py** - Flask application factory with custom CTFdFlask class, theme system, and plugin architecture
- **CTFd/models/** - SQLAlchemy database models for challenges, users, teams, etc.
- **CTFd/api/v1/** - RESTful API endpoints organized by resource type
- **CTFd/admin/** - Administrative interface views and logic
- **CTFd/themes/** - Template system with core/core-beta themes and admin interface
- **CTFd/plugins/** - Plugin system for extending functionality
- **CTFd/utils/** - Utility modules for common operations (auth, crypto, email, etc.)

### Key Components

- **Theme System**: Custom Jinja2 loaders supporting theme inheritance and plugin templates
- **Plugin Architecture**: Extensible system for custom challenges, authentication, and features
- **Multi-tenancy**: Support for individual and team-based competitions
- **API Design**: REST API with marshmallow serialization and Flask-RESTX documentation
- **Security**: CSRF protection, sanitization, rate limiting, and secure session handling

### Database Models

Primary models include Challenges, Users, Teams, Solves, Flags, Hints, Files, and Awards with comprehensive relationships and constraints.

### Frontend Architecture

- **Vue.js components** for interactive admin interface features
- **Bootstrap 4** for responsive design
- **Webpack** build system with SCSS and JavaScript bundling
- **ECharts** for data visualization and scoring graphs

## Development Workflow

### Installation

1. `pip install -r requirements.txt` - Install Python dependencies
2. `pip install -r development.txt` - Install development dependencies
3. `yarn install` - Install Node.js dependencies
4. `python serve.py` - Start development server

### Plugin Development

Plugins are located in `CTFd/plugins/` with standardized structure including `__init__.py`, templates, and assets directories.

### Theme Development

Themes in `CTFd/themes/` with templates, static assets, and configuration. The system supports theme fallback and inheritance.

### Testing Strategy

- **Unit tests** with pytest covering models, API endpoints, and utilities
- **Integration tests** for complete user workflows
- **Security testing** with bandit for common vulnerabilities
- **Frontend testing** through webpack verification

## Important Configuration

- **CTFd/config.py** - Main application configuration
- **CTFd/config.ini** - Instance-specific settings
- **requirements.txt** - Python dependencies (auto-generated by pip-compile)
- **package.json** - Node.js dependencies and build scripts
- **Makefile** - Development workflow commands
